name: Run Tests

on:
  push:
  pull_request:

jobs:
  tests:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
    - name: Checkout source
      uses: actions/checkout@v3

    # - name: Set up caching
    #   uses: actions/cache@v3
    #   id: cache-proj
    #   with:
    #     path: ~/local
    #     key: proj-${{ runner.os }}-8.1.1-0

    # - name: Write value
    #   if: steps.cache-proj.outputs.cache-hit != 'true'
    #   run: |
    #     mkdir ~/local
    #     echo 3.14159 > ~/local/pi.txt

    - name: Set up Python ${{ inputs.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
        cache-dependency-path: |
          ci/test_requirements.txt
          ci/requirements.txt

    - name: Setup PROJ
      uses: Unidata/MetPy/.github/actions/setup-proj@main

    # This installs the stuff needed to build and install Shapely and CartoPy from source.
    # - name: Install CartoPy build dependencies
    #   if: ${{ inputs.need-cartopy == 'true' }}
    #   shell: bash
    #   run: |
    #     sudo apt-get install libgeos-dev
    #     python -m pip install --upgrade pip setuptools
    #     python -m pip install --no-binary :all: shapely

    - name: Install dependencies
      shell: bash
      run: python -m pip install -r ci/test_requirements.txt -c ci/requirements.txt

    # - name: Install extra dependencies
    #   if: ${{ inputs.need-cartopy == 'true' }}
    #   shell: bash
    #   run: python -m pip install -r ci/extra_requirements.txt -c ci/${{ inputs.version-file }}

    # - name: Download Cartopy Maps
    #   if: ${{ inputs.need-cartopy == 'true' }}
    #   shell: bash
    #   run: ci/download_cartopy_maps.py

    # - name: Install
    #   shell: bash
    #   run: python -m pip install -c ci/${{ inputs.version-file }} .

    - name: Tests
      run: sleep 10

